<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wine Recommender</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            oldbg: "#0f0b08",
            oldcard: "#13100f",
            gold: "#bfa56a",
            muted: "#9e8f7a",
          },
          fontFamily: {
            serif: ['Georgia', 'serif'],
          }
        }
      }
    }
  </script>
  <style>
    /* gold-styled double range visuals */
    .range-track { position: relative; height: 10px; }
    input[type=range].double { -webkit-appearance:none; width:100%; background:transparent; position: absolute; left:0; top:0; }
    input[type=range].double::-webkit-slider-thumb{ -webkit-appearance:none; width:16px; height:16px; border-radius:50%; background:#bfa56a; border:2px solid #1a1410; }
    /* visual track behind the ranges */
    .track-bg{ height:10px; background:linear-gradient(90deg,#3a342e, #3a342e); border-radius:8px; }
    /* selected segment overlay */
    .track-selected{ position:absolute; height:10px; background:linear-gradient(90deg,#bfa56a,#bfa56a); border-radius:8px; top:0; }

    details summary { list-style:none; }
    details[open] summary::after{ content: " ‚ñ¥"; }
    details summary::after{ content: " ‚ñæ"; }

    /* dropdown options style ‚Äî dark bg, light text, fixed height + scroll */
    .options-box{ background: #13100f; color: #efe7dc; max-height: 9rem; overflow-y: auto; padding: 0.5rem; border-radius: 0.375rem; }
    .options-box label{ display:flex; align-items:center; gap:0.5rem; padding:0.25rem 0.25rem; }
    .options-box input[type=checkbox]{ width:16px; height:16px; }
  </style>
</head>
<body class="min-h-screen bg-oldbg text-[#efe7dc] p-6">
  <header class="max-w-6xl mx-auto mb-8">
    <h1 class="text-4xl font-serif tracking-wide text-gold">Wine Recommender</h1>
  </header>

  <main class="max-w-6xl mx-auto">
    <!-- Search -->
    <label class="block text-sm mb-2 text-[#d8cfae]">Describe what you'd like</label>
    <div class="flex gap-3 mb-6">
      <input id="query" placeholder="e.g. rich red, cherry, chocolate" class="w-full rounded-lg py-3 px-4 text-oldbg font-medium" />
      <button id="searchBtn" class="px-5 rounded-lg font-semibold py-3 bg-gold text-oldbg">Search</button>
    </div>

    <!-- Filters -->
    <aside class="p-4 rounded-lg border border-[#2b261f] shadow-inner mb-10">
      <h3 class="font-medium mb-4 text-[#efe3c8]">Filters</h3>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <!-- Variety -->
        <div>
          <label class="block text-sm mb-1">Variety</label>
          <details id="varietyDetails" class="bg-oldcard border border-[#2b261f] rounded-lg p-2">
            <summary id="varietySummary" class="text-muted select-none">Select variety</summary>
            <div id="varietyOptions" class="options-box mt-2"></div>
          </details>
        </div>

        <!-- Country -->
        <div>
          <label class="block text-sm mb-1">Country</label>
          <details id="countryDetails" class="bg-oldcard border border-[#2b261f] rounded-lg p-2">
            <summary id="countrySummary" class="text-muted select-none">Select country</summary>
            <div id="countryOptions" class="options-box mt-2"></div>
          </details>
        </div>

        <!-- Price (double range) -->
        <div>
          <label class="block text-sm mb-1">Price range</label>
          <div class="range-track mb-2 relative">
            <div class="track-bg"></div>
            <div id="trackSelected" class="track-selected"></div>
            <input type="range" id="priceMin" class="double" />
            <input type="range" id="priceMax" class="double" />
          </div>
          <div class="flex justify-between text-sm"><div>Min: $<span id="priceMinVal"></span></div><div>Max: $<span id="priceMaxVal"></span></div></div>
        </div>
      </div>
    </aside>

    <div id="count" class="text-sm text-[#cfc6ad] mb-3"></div>

    <section id="cards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></section>
  </main>

<script>
// --- Data ---
const WINES = [
  {id:1,name:"Henry Earl 2012 Malbec",region:"Red Mountain",variety:"Malbec",country:"US",price:40,similarity:0.805,explanation:`The Henry Earl 2012 Malbec from Red Mountain is an excellent match for your request of a rich red wine with notes of cherry and chocolate. This fully-flavored wine showcases dark fruit aromas and oxidative notes, including coffee and dark cherry, which align with the flavor profile you're looking for. Additionally, its $40 price point offers a premium quality that justifies its rich and complex taste, making it a perfect choice for your palate.`},
  {id:2,name:"Ch√¢teau Beauclaire 2008",region:"Bordeaux",variety:"Cabernet Sauvignon",country:"France",price:120,similarity:0.91,explanation:"Ch√¢teau Beauclaire 2008 is a classic Bordeaux with tobacco, blackcurrant and cedar notes. It pairs with your preference for structured, tannic reds with long finish."},
  {id:3,name:"Santorini Sun 2019 Assyrtiko",region:"Santorini",variety:"Assyrtiko",country:"Greece",price:28,similarity:0.62,explanation:"A mineral-driven white with citrus zest and saline finish ‚Äî a lively match if you're after crisp, high-acid whites."},
  {id:4,name:"Valle Noble 2018 Malbec",region:"Mendoza",variety:"Malbec",country:"Argentina",price:22,similarity:0.72,explanation:"Ripe plum and spice, soft tannins. Great value Malbec that brings fruit-forward energy."}
];

// --- Elements ---
const varietyOptions = document.getElementById('varietyOptions');
const countryOptions = document.getElementById('countryOptions');
const varietySummary = document.getElementById('varietySummary');
const countrySummary = document.getElementById('countrySummary');
const priceMinEl = document.getElementById('priceMin');
const priceMaxEl = document.getElementById('priceMax');
const priceMinVal = document.getElementById('priceMinVal');
const priceMaxVal = document.getElementById('priceMaxVal');
const trackSelected = document.getElementById('trackSelected');
const cardsEl = document.getElementById('cards');
const countEl = document.getElementById('count');
const queryEl = document.getElementById('query');
const searchBtn = document.getElementById('searchBtn');

// --- Populate options ---
const varieties = [...new Set(WINES.map(w=>w.variety))].sort();
const countries = [...new Set(WINES.map(w=>w.country))].sort();

function createOption(labelText, className){
  const label = document.createElement('label');
  label.className = 'flex items-center gap-2 p-1 text-sm text-[#efe7dc]';
  const chk = document.createElement('input');
  chk.type = 'checkbox'; chk.value = labelText; chk.className = className;
  label.appendChild(chk);
  const span = document.createElement('span'); span.textContent = labelText; label.appendChild(span);
  return label;
}

varieties.forEach(v=> varietyOptions.appendChild(createOption(v,'varietyCheck')));
countries.forEach(c=> countryOptions.appendChild(createOption(c,'countryCheck')));

// --- Price setup (double range) ---
const priceValues = WINES.map(w=>w.price);
const dataMin = 0;
const dataMax = Math.max(...priceValues);
const paddedMax = Math.max(50, Math.ceil(dataMax/10)*10);
priceMinEl.min = dataMin; priceMinEl.max = paddedMax; priceMinEl.value = dataMin;
priceMaxEl.min = dataMin; priceMaxEl.max = paddedMax; priceMaxEl.value = paddedMax;
priceMinVal.textContent = priceMinEl.value; priceMaxVal.textContent = priceMaxEl.value;

function updateTrack(){
  const min = Number(priceMinEl.value); const max = Number(priceMaxEl.value);
  const range = paddedMax - dataMin;
  const left = ((min - dataMin) / range) * 100;
  const width = ((max - min) / range) * 100;
  trackSelected.style.left = left + '%';
  trackSelected.style.width = Math.max(width, 0) + '%';
}

function clampRanges(){
  let min = Number(priceMinEl.value); let max = Number(priceMaxEl.value);
  if(min > max){ // keep them sensible
    if(this === priceMinEl){ priceMinEl.value = max; min = max; }
    else { priceMaxEl.value = min; max = min; }
  }
  priceMinVal.textContent = min; priceMaxVal.textContent = max;
  updateTrack();
}

priceMinEl.addEventListener('input', clampRanges);
priceMaxEl.addEventListener('input', clampRanges);

// initialize track visually after layout
window.addEventListener('load', ()=>{ updateTrack(); });

// --- Helpers to update summary text ---
function updateSummaryText(){
  const vCount = document.querySelectorAll('.varietyCheck:checked').length;
  const cCount = document.querySelectorAll('.countryCheck:checked').length;
  varietySummary.textContent = vCount ? `${vCount} selected` : 'Select variety';
  countrySummary.textContent = cCount ? `${cCount} selected` : 'Select country';
}

document.addEventListener('change', (e)=>{ if(e.target.matches('.varietyCheck, .countryCheck')){ updateSummaryText(); filterWines(); } });

// --- Filtering ---
function filterWines(){
  const q = queryEl.value.trim().toLowerCase();
  const vs = [...document.querySelectorAll('.varietyCheck:checked')].map(n=>n.value);
  const cs = [...document.querySelectorAll('.countryCheck:checked')].map(n=>n.value);
  const minP = Number(priceMinEl.value); const maxP = Number(priceMaxEl.value);

  const out = WINES.filter(w=>{
    if(vs.length && !vs.includes(w.variety)) return false;
    if(cs.length && !cs.includes(w.country)) return false;
    if(w.price < minP || w.price > maxP) return false;
    if(q && !(`${w.name} ${w.region} ${w.variety} ${w.country} ${w.explanation}`.toLowerCase().includes(q))) return false;
    return true;
  }).sort((a,b)=> b.similarity - a.similarity);

  renderCards(out);
}

// --- Render cards ---
function renderCards(list){
  cardsEl.innerHTML = '';
  countEl.textContent = `Showing ${list.length} recommendation(s)`;
  if(!list.length){ cardsEl.innerHTML = `<div class='text-center text-muted col-span-full mt-10'>No matches found.</div>`; return; }
  list.forEach(w=>{
    const el = document.createElement('article'); el.className = 'p-5 rounded-2xl shadow-lg bg-oldcard border border-[#2a241e]';
    el.innerHTML = `
      <div class='flex items-start gap-3'>
        <div class='text-3xl'>üç∑</div>
        <div>
          <div class='font-serif text-lg' style='color: #bfa56a;'>${w.name} <span class='text-sm text-muted'>(${w.region})</span></div>
          <div class='mt-2 text-sm text-[#cfc6ad]'>
            <div>üìç Variety: <span class='font-medium'>${w.variety}</span></div>
            <div>üåç Country: <span class='font-medium'>${w.country}</span></div>
            <div>üí∞ Price: <span class='font-medium'>$${w.price.toFixed(2)}</span></div>
            <div>‚≠ê Similarity: <span class='font-medium'>${w.similarity.toFixed(3)}</span></div>
          </div>
        </div>
      </div>
      <div class='mt-4 text-sm text-[#e9dfc9]'>
        <div class='font-semibold mb-2'>üí° Explanation:</div>
        <p class='text-sm leading-relaxed'>${w.explanation}</p>
      </div>`;
    cardsEl.appendChild(el);
  });
}

// wire up search button and initial render
searchBtn.addEventListener('click', filterWines);
updateSummaryText();
filterWines();
</script>
</body>
</html>